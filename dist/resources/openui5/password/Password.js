sap.ui.define(["jquery.sap.global","sap/m/InputBase","sap/m/List","sap/m/ResponsivePopover","sap/m/StandardListItem","sap/ui/core/ValueState","./PasswordRenderer","./thirdparty/zxcvbn","./library"],function(e,t,r,o,s,i,n,a){"use strict";const u=t.extend("Password",{metadata:{library:"openui5.password",properties:{requireNumbers:{type:"boolean",group:"Behavior",defaultValue:true},requireLetters:{type:"boolean",group:"Behavior",defaultValue:true},requireSymbols:{type:"boolean",group:"Behavior",defaultValue:true},requireLowercase:{type:"boolean",group:"Behavior",defaultValue:true},requireUppercase:{type:"boolean",group:"Behavior",defaultValue:true},maxLength:{type:"int",group:"Behavior",defaultValue:0},minLength:{type:"int",group:"Behavior",defaultValue:0},score:{type:"int",group:"Behavior",defaultValue:0}},aggregations:{errorItems:{type:"sap.m.StandardListItem",multiple:true,singularName:"errorItem"}}},renderer:function(e,t){n.render(e,t)}});u.prototype.init=function(){t.prototype.init.call(this);this._resourceBundle=sap.ui.getCore().getLibraryResourceBundle("openui5.password")};u.prototype.exit=function(){t.prototype.exit.call(this);if(this._popover){this._popover.destroy();this._popover=null}};u.prototype.oninput=function(e){t.prototype.oninput.call(this,e);if(e.isMarked("invalid")){return}const r=this._calculateScore(this._$input.val());this._setStatus(r);this.setScore(r)};u.prototype.onfocusin=function(e){t.prototype.onfocusin.apply(this,arguments);this.$().addClass("sapMInputFocused");if(this._popover){this._popover.close()}};u.prototype.onfocusout=function(e){t.prototype.onfocusout.apply(this,arguments);this.$().removeClass("sapMInputFocused");this.closeValueStateMessage(this)};u.prototype.onsapfocusleave=function(e){this._showPasswordErrors();t.prototype.onsapfocusleave.apply(this,arguments)};u.prototype.setWidth=function(e){return t.prototype.setWidth.call(this,e||"100%")};u.prototype.getWidth=function(){return this.getProperty("width")||"100%"};u.prototype._showPasswordErrors=function(){const e=this._getPasswordErrors(this._$input.val());if(e.length>0){this._getPopover(e).openBy(this);this.setValueState(i.Error)}else{this.setValueState(i.Success)}};u.prototype._getPopover=function(e){if(!this._popover){this._createPopover()}this._addPasswordErrorsToPopover(e||[]);return this._popover};u.prototype._createPopover=function(){this._popover=new o(this.getId()+"-popover",{title:this._resourceBundle.getText("PASSWORD_POPUP_TITLE"),placement:"Vertical",icon:"sap-icon://alert"});this._popover.addContent(new r({}));this.addDependent(this._popover)};u.prototype._addPasswordErrorsToPopover=function(e){const t=this._popover.getContent()[0];t.removeAllItems();t.destroyItems();e.forEach(function(e){t.addItem(e)})};u.prototype._getPasswordErrors=function(e){this.destroyAggregation("errorItems");const t=this;const r=[];let o=/\d/;if(this.getRequireNumbers()&&!o.test(e)){r.push(new s({title:this._resourceBundle.getText("PASSWORD_MUST_HAVE_NUMBER"),info:"[0-9]",infoState:i.Error}))}o=/[a-zA-Z]/;if(this.getRequireLetters()&&!o.test(e)){r.push(new s({title:this._resourceBundle.getText("PASSWORD_MUST_HAVE_LETTER"),info:"[a-z , A-Z]",infoState:i.Error}))}o=/[a-z]/;if(this.getRequireLowercase()&&!o.test(e)){r.push(new s({title:this._resourceBundle.getText("PASSWORD_MUST_HAVE_LOWERCASE_LETTER"),info:"[a-z]",infoState:i.Error}))}o=/[A-Z]/;if(this.getRequireUppercase()&&!o.test(e)){r.push(new s({title:this._resourceBundle.getText("PASSWORD_MUST_HAVE_UPPERCASE_LETTER"),info:"[A-Z]",infoState:i.Error}))}o=/\W/;if(this.getRequireSymbols()&&!o.test(e)){r.push(new s({title:this._resourceBundle.getText("PASSWORD_MUST_HAVE_SYMBOL"),info:"[!, @, #, $, %, &...]",infoState:i.Error}))}if(this.getMinLength()>0&&e.length<this.getMinLength()){r.push(new s({title:this._resourceBundle.getText("PASSWORD_MUST_HAVE_NOT_LESS"),info:this._resourceBundle.getText("PASSWORD_LIMIT_CHARACTERS",this.getMinLength()),infoState:i.Error}))}if(this.getMaxLength()>0&&e.length>this.getMaxLength()){r.push(new s({title:this._resourceBundle.getText("PASSWORD_MUST_HAVE_NOT_MORE"),info:this._resourceBundle.getText("PASSWORD_LIMIT_CHARACTERS",this.getMaxLength()),infoState:i.Error}))}r.forEach(function(e){t.addAggregation("errorItems",e,true)});return r};u.prototype._calculateScore=function(e){if(!e||e.length<1){return 0}return zxcvbn(e).score||0};u.prototype._setStatus=function(e){const t=this._getStatus(e);this.setValueState(t.state);this.setValueStateText(t.text)};u.prototype._getStatus=function(e){let t={state:i.None,text:""};switch(e){case 0:t={state:i.Error,text:this._resourceBundle.getText("PASSWORD_IS_VERY_WEAK")};break;case 1:t={state:i.Error,text:this._resourceBundle.getText("PASSWORD_IS_WEAK")};break;case 2:t={state:i.Warning,text:this._resourceBundle.getText("PASSWORD_IS_NOT_STRONG_ENOUGH")};break;case 3:t={state:i.Success,text:this._resourceBundle.getText("PASSWORD_IS_STRONG")};break;case 4:t={state:i.Success,text:this._resourceBundle.getText("PASSWORD_IS_VERY_STRONG")};break;default:break}return t};return u},true);